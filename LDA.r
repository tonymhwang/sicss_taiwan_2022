library(reticulate)
library(tm)

library(data.table)
library(dplyr)
library(ggplot2)
library(magrittr)
library(tidyr)
library(tidytext)
library(topicmodels)

use_virtualenv('C:/python_venv/venv2/', required = TRUE)
py_config()

ckip = import("ckiptagger")

ws = ckip$WS("./data")

sentence_list <- list(
  "é€™å¹¾å¹´ä¾†ï¼Œåœ¨åœ‹è»çš„æ”œæ‰‹åŠªåŠ›ä¸‹ï¼Œæˆ‘å€‘ç©æ¥µæŽ¨å‹•çš„è»äº‹æ”¹é©ã€åœ‹é˜²è‡ªä¸»æ”¿ç­–ï¼Œéƒ½æœ‰å¾ˆå¥½çš„é€²å±•ï¼ŒåŒ…æ‹¬åœ‹è‰¦åœ‹é€ ã€åœ‹æ©Ÿåœ‹é€ ç­‰ï¼Œéƒ½èƒ½æŒ‰ç…§æ—¢å®šæœŸç¨‹åŸ·è¡Œï¼Œæœ‰æ•ˆæå‡åœ‹é˜²æˆ°åŠ›ã€‚
  ä»Šå¤©ï¼Œåœ¨é™¸æµ·ç©ºè»æ™‰ä»»å°‡å®˜å‹—å‹‰å…¸ç¦®ï¼Œæˆ‘ä¹ŸæœŸè¨±æˆ‘å€‘åœ‹è»é ˜å°Žå¹¹éƒ¨ï¼ŒæŒçºŒç‚ºåœ‹å®¶åŸ¹é¤Šäººæ‰ï¼Œä¸€èµ·è®“åœ‹è»çš„æˆ°åŠ›ä¸æ–·ç²¾é€²ã€‚
  ç•¶å‰ï¼Œæˆ‘å€‘é¢å°ç–«æƒ…çš„æŒ‘æˆ°ï¼Œä»¥åŠçž¬æ¯è¬è®Šçš„åœ‹éš›æƒ…å‹¢ï¼Œæˆ‘å€‘åœ‹è»ä¸åƒ…ä¸èƒ½æœ‰ä»»ä½•é¬†æ‡ˆï¼Œæ›´è¦æŒçºŒå¼·åŒ–å®ˆè­·åœ‹å®¶å®‰å…¨çš„åŠ›é‡ï¼Œè®“ä¸–ç•Œçœ‹è¦‹æˆ‘å€‘ä¿å®¶è¡›åœ‹çš„æ±ºå¿ƒã€‚
  ç‰¹åˆ¥æ˜¯å¾žç–«æƒ…çˆ†ç™¼ä»¥ä¾†ï¼Œæˆ‘å€‘çš„åœ‹è»å®˜å…µç§‰æŒè‘—ã€Œé˜²ç–«è¦–åŒä½œæˆ°ã€çš„ç²¾ç¥žï¼Œç©æ¥µæŠ•å…¥å„é …é˜²ç–«ä½œç‚ºã€‚åªè¦ç•¶åœ‹äººæœ‰éœ€è¦çš„æ™‚å€™ï¼Œå°±æœƒç«‹åˆ»å‡ºå‹•å”åŠ©ã€æ”¯æ´ã€‚
  åœ‹è»æ˜¯å®ˆè­·åœ‹å®¶ã€ä¿è¡›äººæ°‘çš„å …å¯¦å±éšœï¼Œç›¸ä¿¡åœ‹äººå°åœ‹è»å®˜å…µçš„ä»˜å‡ºéƒ½æ·±å—æ„Ÿå‹•ï¼Œä¹Ÿéžå¸¸è‚¯å®šã€‚èº«ç‚ºä¸‰è»çµ±å¸¥ï¼Œæˆ‘ä¹ŸåŒæ„Ÿå…‰æ¦®ã€‚
  æˆ‘ä¹Ÿè—‰è‘—ä»Šå¤©ï¼Œæ„Ÿè¬åœ‹è»å®¶äººçš„æ”¯æŒï¼Œæˆç‚ºåœ‹è»é€²æ­¥çš„æœ€å¤§å‹•åŠ›ã€‚æˆ‘å€‘æœƒç¹¼çºŒåŠªåŠ›ï¼ŒæŽ¨å‹•åœ‹é˜²æ”¿ç­–ï¼Œå®ˆè¡›å®¶åœ’ï¼"
  ,
  "æœ€è¿‘ï¼Œåœ¨ç–«æƒ…çš„æŒ‘æˆ°ä¸‹ï¼Œæˆ‘å€‘ä»æœ‰è¨±å¤šé«”è‚²é¸æ‰‹åœ¨åœ‹éš›èˆžå°ä¸Šè¡¨ç¾ç²¾é‡‡ï¼Œå±•ç¾å°ç£çš„é«”è‚²å¯¦åŠ›ã€‚
  ä¸‹å€‹æœˆï¼Œç¬¬11å±† #ä¸–ç•Œé‹å‹•æœƒ ä¹Ÿå°‡åœ¨ç¾Žåœ‹ä¼¯æ˜Žç½•èˆ‰è¡Œã€‚ä»Šå¤©ï¼Œæˆ‘ä¾†ç‚ºæˆ‘å€‘çš„ä»£è¡¨åœ˜æŽˆæ——ï¼ŒæœŸè¨±é¸æ‰‹å€‘éƒ½èƒ½åœ¨ä¸–ç•Œè³½å ´ä¸Šç™¼å…‰ç™¼ç†±ï¼
  å…¶ä¸­ï¼Œæˆ‘å€‘çš„å¥³å­æ‹”æ²³éšŠå¾ž2005å¹´ä¸–é‹æœƒé–‹å§‹ï¼Œå°±å¥ªä¸‹äº†é€£çºŒ4å±†çš„é‡‘ç‰Œï¼Œé€™æ¬¡æ›´è¦ä»¥5é€£éœ¸ç‚ºç›®æ¨™ã€‚å¥åŠ›ä»£è¡¨éšŠå‰‡å¾ž1993å¹´çš„ä¸–é‹æœƒé–‹å§‹ï¼Œæ¯å±†éƒ½æœ‰å¥ªç‰Œçš„ç´€éŒ„ï¼ŒæœŸå¾…é¸æ‰‹å€‘èƒ½å¤ å†å‰µä½³ç¸¾ã€‚
  é‚„æœ‰æˆ‘å€‘çš„åˆçƒä»£è¡¨éšŠï¼Œç›®å‰æ˜¯ä¸–ç•ŒæŽ’åç¬¬3ï¼Œäºžæ´²æŽ’åç¬¬1ã€‚åœ¨ä¸Šå±†ä¸–é‹æœƒä¹Ÿç²å¾—éŠ€ç‰Œï¼Œå‰µä¸‹åƒè³½ä»¥ä¾†æœ€å¥½çš„æˆç¸¾ï¼Œå¸Œæœ›é€™æ¬¡èƒ½å¤ å¥ªä¸‹é‡‘ç‰Œã€å†æ¬¡åˆ·æ–°ç´€éŒ„ã€‚
  ç–«æƒ…æœŸé–“å‡ºåœ‹æ¯”è³½å¾ˆä¸å®¹æ˜“ï¼Œç‚ºäº†è®“é¸æ‰‹å……åˆ†ç™¼æ®å¯¦åŠ›ï¼Œæˆ‘å€‘ä¹Ÿè¨­ç½®å››åéš¨éšŠçš„é†«å¸«ï¼Œå”åŠ©æ³¨æ„é˜²ç–«ï¼Œå…¨ç¨‹ç…§é¡§ä»£è¡¨åœ˜çš„å¥åº·å®‰å…¨ã€‚
  æœŸå¾…æ¯ä¸€ä½é¸æ‰‹éƒ½èƒ½åœ¨è³½å ´ä¸Šï¼ŒæŒ‘æˆ°è‡ªæˆ‘ï¼Œå…¨åŠ›ä»¥èµ´ï¼Œç‚ºè‡ªå·±å–å¾—æœ€é«˜çš„æ¦®è€€ï¼Œä¹Ÿç”¨æœ€é«˜çš„æ‹šå‹å’ŒéŸŒæ€§ï¼Œè®“ä¸–ç•Œçœ‹åˆ°å°ç£ã€‚
  æˆ‘ä¹Ÿè¦è«‹å¤§å®¶ä¸€èµ·é—œæ³¨è³½äº‹ï¼Œç‚ºæˆ‘å€‘çš„é¸æ‰‹åŠ æ²¹ï¼"
  ,
  "6å€‹æœˆè‡³5æ­²å¹¼å…’ï¼Œé–‹æ”¾æŽ¥ç¨®å…©åŠ‘èŽ«å¾·ç´ç–«è‹—ï¼
  é€™å€‹æœˆä»¥ä¾†ï¼Œç¬¬ä¸€åŠ‘ç–«è‹—æ¶µè“‹çŽ‡å·²ç¶“è¶…éŽä¹æˆï¼Œæˆ‘å€‘ä¹Ÿè¦æå‡å¹¼å…’çš„ç–«è‹—ä¿è­·åŠ›ã€‚æŒ‡æ®ä¸­å¿ƒä»Šå¤©æ ¹æ“šACIPå°ˆå®¶æœƒè­°æ±ºè­°å®£å¸ƒï¼š
  ðŸ”º6å€‹æœˆè‡³5æ­²å¹¼å…’ï¼Œé–‹æ”¾æŽ¥ç¨®å…©åŠ‘èŽ«å¾·ç´ç–«è‹—ï¼Œå…©åŠ‘é–“éš”4è‡³8é€±ä»¥ä¸Šã€‚
  æ­¤å¤–ï¼Œé‡å°5-11æ­²å…’ç«¥ï¼Œç›®å‰å…¨åœ‹å„åœ°æ­£é€²è¡Œç¬¬äºŒåŠ‘ç–«è‹—æŽ¥ç¨®ä½œæ¥­ï¼ŒACIPä¹Ÿå»ºè­°è‹¥å…©åŠ‘æ‰“æ»¿5å€‹æœˆ(150å¤©)å¾Œï¼Œå¯ä»¥æŽ¥ç¨®ç¬¬ä¸‰åŠ‘ï¼Œè€Œ18æ­²ä»¥ä¸Šæˆäººå¯ä»¥æŽ¥ç¨®Novavaxç–«è‹—ç¬¬ä¸€ã€äºŒã€ä¸‰ã€å››åŠ‘ã€‚
  æˆ‘ä¹Ÿè¦æé†’å¤§å®¶ï¼Œç–«è‹—æŽ¥ç¨®æ™‚é–“åŠä½œæ¥­ï¼Œå¾…æŒ‡æ®ä¸­å¿ƒåŠåœ°æ–¹è¡›ç”Ÿå±€å®‰æŽ’ï¼Œè«‹çˆ¸çˆ¸åª½åª½å¯ä»¥è€ƒæ…®å¸¶å­©å­å‰å¾€æŽ¥ç¨®ï¼Œä¸€èµ·å®ˆè­·æˆ‘å€‘çš„å°å°å­©ã€‚
  é‚„æœ‰7/1èµ·ï¼Œæ”¿åºœç¬¬äºŒè¼ªå…è²»æä¾›0è‡³6æ­²å¹¼å…’(2015/9/2(å«)å¾Œå‡ºç”Ÿè€…ç‚ºé™)5åŠ‘å¿«ç¯©è©¦åŠ‘ï¼Œå®¶é•·ä¹Ÿéƒ½å¯ä»¥è‡³å¥ä¿ç‰¹ç´„è—¥å±€åŠè¡›ç”Ÿæ‰€é ˜å–ã€‚
  è¿‘ä¾†ï¼Œå…¨åœ‹ç–«æƒ…å·²ç¶“é€æ­¥è¶¨ç·©ï¼Œæˆ‘å€‘æœƒæŒçºŒåšå¥½é˜²ç–«å·¥ä½œï¼Œç©©å¥èµ°å‘ç–«å¾Œæ­£å¸¸ç”Ÿæ´»ã€‚"
  ,
  "ã€ŒæŠ—ç™Œå°å¤©ä½¿ã€æ½˜ç›ˆå¸Œå°å¦¹å¦¹ä¸åƒ…å‹‡æ•¢å°æŠ—ç—…æƒ…ï¼Œæ›´æ˜¯ä¸€ä½å°ç•«å®¶ï¼Œç”¨å‰µä½œå¸¶çµ¦å¾ˆå¤šäººé¼“å‹µã€‚
  å‰é™£å­ï¼Œç›ˆå¸Œè¨±ä¸‹ä¸‰å€‹é¡˜æœ›ï¼Œå…¶ä¸­ä¸€å€‹æ˜¯æƒ³æ‰¾è”¡æƒ³æƒ³ã€‚ä»Šå¤©ï¼Œæˆ‘é‚€è«‹ç›ˆå¸Œä¸€å®¶äººä¾†å®˜é‚¸ï¼Œé™¤äº†å¸¶ä»–å€‘èªè­˜è”¡æƒ³æƒ³ï¼Œä¹Ÿä¸€èµ·ä»‹ç´¹æˆ‘å®¶å…¶ä»–çš„æ¯›å°å­©ï¼šé˜¿æ‰ã€æ¨‚æ¨‚ã€Bellaã€Bunnyå’ŒMaruã€‚
  é›–ç„¶å®³ç¾žçš„é˜¿æ‰ä¸€ç›´èº²èµ·ä¾†ï¼Œä¸å¤ªçµ¦æˆ‘é¢å­ï¼Œä¸éŽï¼Œçœ‹åˆ°äººå°±å¾ˆèˆˆå¥®çš„æ¨‚æ¨‚ï¼Œå€’æ˜¯è·Ÿç›ˆå¸Œå§Šå¦¹å€†çŽ©ä¸ŸæŽ¥çƒçŽ©å¾—è »é–‹å¿ƒçš„ã€‚
  ä¸åªç›ˆå¸Œå‹‡æ•¢æŽ¥å—æ²»ç™‚ï¼Œç›ˆå¸Œçš„çˆ¸çˆ¸åª½åª½ä¹Ÿå¾ˆåŠªåŠ›ç…§é¡§å­©å­ï¼Œä¸¦æŠŠé€™ä»½ç¶“é©—åˆ†äº«çµ¦ç¤¾æœƒï¼Œå¹«åŠ©æ›´å¤šäººï¼ŒçœŸçš„å¾ˆä»¤äººæ•¬ä½©ã€‚
  æˆ‘ä¹Ÿè¦è¬è¬  é„­æ–‡ç‡¦ å¸‚é•· ä»¥åŠ  é„­é‹éµ¬ å§”å“¡ï¼Œå…ˆå‰å”åŠ©ç›ˆå¸Œç›¡é€Ÿè§£æ±ºç¢ºè¨ºé€šå ±ç­‰è¡Œæ”¿å•é¡Œï¼Œè®“å¥¹ç²å¾—å¦¥å–„çš„æ²»ç™‚ç…§é¡§ã€‚
  ç›¸ä¿¡å¤§å®¶éƒ½ç‚ºç›ˆå¸Œä¸€å®¶äººçš„åŠªåŠ›è€Œæ„Ÿå‹•ï¼Œå¸Œæœ›ç›ˆå¸Œèƒ½ç¹¼çºŒåŠ æ²¹ï¼Œç›¡æƒ…äº«å—å‰µä½œçš„å¿«æ¨‚ï¼"
)

stop_words_list <- read.table(file = "./r_data/stop_words.txt", header = TRUE)
stop_words_list <- list(stop_words_list)[[1]][["X."]]
stop_words_list <- append(stop_words_list, c('ï¼Œ', 'ã€‚', 'ã€', 'ã€Œ', 'ã€', 'ï¼', '#', '(', ')', ' ', '  ', '   '))


for(i in 1 : length(sentence_list)){
  sentence_list[[i]] <- gsub('\n', ' ', sentence_list[[i]])
}

word_sentence_list = ws(sentence_list)

for(i in 1 : length(word_sentence_list)){
  word_sentence_list[[i]] <- word_sentence_list[[i]][!word_sentence_list[[i]] %in% stop_words_list]
}

corp = Corpus(VectorSource(word_sentence_list))

dtm = DocumentTermMatrix(corp)

ap_lda <- LDA(dtm, k = 4, control = list(seed = 1234))
ap_lda

ap_topics <- tidy(ap_lda, matrix = "beta")
ap_topics

ap_top_terms <- ap_topics %>%
  group_by(topic) %>%
  top_n(10, beta) %>%
  ungroup() %>%
  arrange(topic, -beta)

ap_top_terms %>%
  mutate(term = reorder(term, beta)) %>%
  ggplot(aes(term, beta, fill = factor(topic))) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~ topic, scales = "free") +
  coord_flip()
